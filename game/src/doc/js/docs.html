<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Neo Script - Commands</title>

    <link rel="stylesheet" href="cssReset.css">
    <link rel="stylesheet" href="variables.css">
    <link rel="stylesheet" href="commands.css">
    <script src="commands.js"></script>
</head>
<body>
    <script>
        printBody();

        function toggleSidebar() {
            let sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("open");
        }
        function closeSidebar() {
            let sidebar = document.getElementById("sidebar");
            sidebar.classList.remove("open");
        }

        function toggleCommand(id) {
            let sidebar = document.getElementById(id);
            sidebar.classList.toggle("closed");
        }
        function openCommand(id) {
            let sidebar = document.getElementById(id);
            sidebar.classList.remove("closed");
        }
        function openAllCommands() {
            let elements = document.getElementsByClassName("commandContainer");
            for (let i = 0; i < elements.length; i++) {
                elements[i].classList.remove("closed");
            }
        }
        function closeAllCommands() {
            let elements = document.getElementsByClassName("commandContainer");
            for (let i = 0; i < elements.length; i++) {
                elements[i].classList.add("closed");
            }
        }

        function printBody() {
            document.write(`
                <div class="outer" id="top">
                    <div class="sidebar" id="sidebar">
                        <button class="button sidebarToggle" onclick="toggleSidebar();">\></button>
                        <div class="flex">
                            <button class="button sidebarButton" onclick="openAllCommands();">Open all</button>
                            <button class="button sidebarButton" onclick="closeAllCommands();">Close all</button>
                        </div>
                        <ul>
            `);

            commands.forEach(command => printLink(command));

            document.write(`
                        </ul>
                    </div>
                    <div class="content">
            `);

            commands.forEach(command => printCommand(command));

            document.write(`
                        <a class="button toTop" href="#top">Up</a>
                    </div>
                </div>
            `);
        }

        function printLink(command) {
            let parameters = constructParameterString(command);

            document.write(`<li><a class="toCommand"
                                    href="#${command.name}${command.parameters.length}"
                                    onclick="closeSidebar(); closeAllCommands(); openCommand('${command.name}${command.parameters.length}')">
                                <span class="type">${command.type}</span>:
                                <span class="name">${command.name}</span> (
                                <span class="parameter">${parameters}</span>)</a></li>`);
        }

        function printCommand(command) {
            let parameters = constructParameterString(command);

            document.write(`<div class="commandContainer" id="${command.name}${command.parameters.length}">
                            <button class="button toggleCommand" onclick="toggleCommand('${command.name}${command.parameters.length}')">Toggle</button>
                            <h2><span class="type">${command.type}</span>:
                                <span class="name">${command.name}</span> (
                                <span class="parameter">${parameters}</span>)</h2>`);

            printParameters(command);

            document.write(`<p class="commandDescription">${command.description}</p>`);

            printExample(command);

            document.write(`</div>`);
        }

        function constructParameterString(command) {
            let parameters = '';
            command.parameters.forEach(p => {
                parameters += ', ';
                if (p.optional) { parameters += '['; }
                parameters += p.name;
                if (p.optional) { parameters += ']'; }
            });
            return parameters.substr(2);
        }

        function printParameters(command) {
            document.write(`<div class="parameterContainer">`);

            command.parameters.forEach(parameter => printParameter(parameter));

            document.write(`</div>`)
        }

        function printParameter(parameter) {
            if (parameter === undefined) { return; }

            document.write(`<p class="parameterField"><span class="type">${parameter.type}</span>: <span class="parameter">${parameter.name}</span></p>`);

            if (parameter.description !== undefined) {
                document.write(`<p class="parameterDescription">${parameter.description}</p>`);
            }
        }

        function printExample(command) {
            if (command.example === undefined) { return; }

            document.write(`
                <p class="exampleTitle">Example:</p>
                <div class="exampleContainer">${command.example}</div>
            `);
        }
    </script>
</body>
</html>